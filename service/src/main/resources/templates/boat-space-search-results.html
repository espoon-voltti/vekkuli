<div x-data="{
    openModal: false,
    boatSpace: {
        id: 0
    } }">
    <h3><span th:text="#{boatApplication.freeSpaceCount}">Hakuehtoihin sopivat vapaat paikat</span> <span
            th:text="${spaceCount}">0</span></h3>
    <div class="block" th:each="harbor : ${harbors}" x-data="{ showAll: false }">
        <h2 class="label harbor-header" th:text="${harbor.location.name}">Satama</h2>
        <table class="table is-striped is-hoverable is-fullwidth">
            <thead>
            <tr>
                <th th:text="#{boatSpaces.size}">Paikan koko</th>
                <th th:text="#{boatSpaces.amenityLabel}">Varuste</th>
                <th th:text="#{boatSpaces.price}">Hinta</th>
                <th th:text="#{boatSpaces.place}">Paikka</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="result, iterStat : ${harbor.boatSpaces}" :class="{'is-hidden': !showAll && $el.rowIndex > 3}">
                <td>
                    <span th:text="${result.formattedSizes}"></span>
                </td>
                <td th:text="#{${'boatSpaces.amenityOption.' + result.amenity}}">
                </td>
                <td th:text="${result.price}">420â‚¬</td>
                <td><span th:text="${result.section}"></span><span
                        th:text="${result.placeNumber.toString()}"></span>
                </td>
                <td>
                    <form th:if="${isAuthenticated}" th:action="|/kuntalainen/venepaikka/varaa/${result.id}|"
                          method="get">
                        <input type="hidden" name="boatType" th:value="${boat.type}" />
                        <input type="hidden" name="width" th:value="${boat.width}" />
                        <input type="hidden" name="length" th:value="${boat.length}" />
                        <button type="submit"
                                class="button is-primary reserve-button"
                                th:text="#{boatSpaces.reserve}">Varaa
                        </button>
                    </form>
                    <!--                       -->
                    <a th:if="${!isAuthenticated}"
                       th:attr="${'x-on:click'}=|openModal = true; boatSpace = {
                            id: ${result.id},
                            place: '${harbor.location.name} ${result.section}${result.placeNumber.toString()}',
                            size: '${result.formattedSizes}',
                            amenity: '#{${'boatSpaces.amenityOption.' + result.amenity}}',
                            price: '${result.price}'
                       };|"
                       class="button is-secondary reserve-button"
                       th:text="#{boatSpaces.reserve}">Varaa
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
        <div th:if="${harbor.boatSpaces.size > 3}">
            <a @click="showAll = !showAll"
               th:attr="x-text='showAll ? \'' + #{showLess} + '\' : \'' + #{showMore} +'\''"
            ></a>
        </div>
    </div>
    <div th:if="${!isAuthenticated}" id="auth-modal" class="modal" x-show="openModal" style="display:none;">
        <div class="modal-underlay" @click="openModal = false"></div>
        <div class="modal-content">
            <p class="block has-text-left" th:text="#{auth.reservingBoatSpace}">Olet varaamassa paikkaa:</p>
            <p class="has-text-left" x-text="boatSpace.place"></p>
            <p class="has-text-left" x-text="boatSpace.size"></p>
            <p class="has-text-left" x-text="boatSpace.amenity"></p>
            <p class="has-text-left block" x-text="boatSpace.price + '&euro;'"></p>
            <p class="has-text-left block" th:text="#{auth.reservingRequiresAuth}"></p>

            <button id="auth-modal-cancel"
                    th:text="#{cancel}"
                    class="button "
                    @click="openModal = false"
                    type="button">
            </button>
            <a id="auth-modal-continue"
               th:text="#{auth.continue}"
               class="button is-primary"
               type="button"
               x-bind:href="'/auth/saml-suomifi/login?RelayState=/kuntalainen/venepaikka/varaa/' + boatSpace.id"
            >
            </a>
        </div>
    </div>
</div>
